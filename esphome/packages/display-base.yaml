---
# esphome/packages/display-base.yaml

font:
  - file: gfonts://Roboto Mono
    id: font_small
    size: 8
  - file: gfonts://Roboto Mono
    id: font_medium
    size: 12

display:
  - platform: ssd1306_i2c
    i2c_id: bus_a
    model: SSD1306 128x64
    address: 0x3C
    update_interval: 1s
    id: main_display
    pages:
      - id: main_page
        lambda: |-
          // Header
          it.printf(0, 0, id(font_small), "Trap ${line_voltage} ${safety_standard}");

          // WiFi Status
          if (id(wifi_component).is_connected()) {
            it.printf(105, 0, id(font_small), "WiFi");
          } else {
            it.printf(100, 0, id(font_small), "No Net");
          }

          // Sensor Status
          it.printf(0, 12, id(font_medium), "Hybrid Detection:");
          it.printf(0, 26, id(font_small), "IR");
          it.printf(20, 26, id(font_small), "%s",
                    (id(ir_presence).state ? "✓" : "○"));
          it.printf(40, 26, id(font_small), "ToF");
          it.printf(70, 26, id(font_small), "%s",
                    (id(distance_sensor).state < id(detection_threshold).state ? "✓" : "○"));
          it.printf(90, 26, id(font_small), "Vib");
          it.printf(115, 26, id(font_small), "%s",
                    (id(accel_x).state > 5.0 ? "✓" : "○"));

          // System Status
          if (id(emergency_stop).state) {
            it.filled_rectangle(0, 38, 128, 12, COLOR_ON);
            it.print(2, 40, id(font_small), COLOR_OFF, ">> EMERGENCY STOP <<");
          } else if (id(trap_triggered).state) {
            it.filled_rectangle(0, 38, 128, 12, COLOR_ON);
            it.print(2, 40, id(font_small), COLOR_OFF, ">> VACUUM ACTIVE <<");
          } else if (id(system_armed).state) {
            it.print(0, 40, id(font_small), "Armed & Monitoring");
            it.print(120, 40, id(font_small), "●");
          } else {
            it.print(0, 40, id(font_small), "System Disarmed");
          }

          // Stats
          it.printf(0, 54, id(font_small), "Captures: %.0f", id(capture_count).state);
          it.printf(70, 54, id(font_small), "Temp: %.1f°C", id(esp32_temp).state);
          if (id(esp32_temp).has_state() && id(esp32_temp).state > ${esp32_temp_warning_threshold}) {
            it.print(120, 56, id(font_small), "!");
          }
