---
name: Create GitHub Issue from Report
description: Creates a GitHub issue using content from a markdown report file and applies specified labels.

inputs:
  issue-title:
    description: Title of the GitHub issue to create
    required: true
  report-file:
    description: Path to the markdown file containing the issue body content
    required: true
  labels:
    description: Comma-separated string of labels to apply to the issue
    required: false
    default: ''
  action-required-message:
    description: Additional markdown message to append to the issue body, typically for action required instructions.
    required: false
    default: ''

runs:
  using: composite
  steps:
    - name: Create GitHub Issue
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');

          let reportContent = '';
          try {
            reportContent = fs.readFileSync('${{ inputs.report-file }}', 'utf8');
          } catch (error) {
            reportContent = 'âŒ Unable to generate report from ${{ inputs.report-file }}';
          }

          let issueBody = `${reportContent}`;

          if ('${{ inputs.action-required-message }}' !== '') {
            issueBody += '\\n\\n' + `${{ inputs.action-required-message }}`;
          }

          const labels = '${{ inputs.labels }}'.split(',').map(label => label.trim()).filter(label => label !== '');

          const issue = await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: '${{ inputs.issue-title }}',
            body: issueBody,
            labels: labels
          });

          console.log(`Created issue #${issue.data.number}`);
